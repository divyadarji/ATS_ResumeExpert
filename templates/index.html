<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATS Resume Expert</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
       
</head>
<body>
<div class="container">
    <h1>ATS Resume Expert</h1>
    <form id="resumeForm" method="POST" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="jobDescription" class="form-label">Job Description</label>
            <textarea class="form-control" id="jobDescription" name="job_description" rows="4" placeholder="Paste the job description here..."></textarea>
        </div>
        <div class="mb-3">
            <label for="resumes" class="form-label">Upload Resumes (PDF)</label>
            <input type="file" class="form-control" id="resumes" name="resumes" accept=".pdf" multiple required>
        </div>
        <div class="mb-3 text-center">
            <button type="button" class="btn btn-primary me-2" id="summarizeButton">Summarize Resumes</button>
            <button type="button" class="btn btn-secondary" id="matchButton">Percentage Match</button>
        </div>
    </form>
    <div id="loader">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p>Processing... Please wait.</p>
    </div>
    <div id="results" class="results"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    const form = document.getElementById('resumeForm');
    const summarizeButton = document.getElementById('summarizeButton');
    const matchButton = document.getElementById('matchButton');
    const loader = document.getElementById('loader');
    const resultsDiv = document.getElementById('results');

    summarizeButton.onclick = () => submitForm('summarize');
    matchButton.onclick = () => submitForm('match');
    const submitForm = async (action) => {
        const formData = new FormData(form);
        formData.append('action', action);

        resultsDiv.innerHTML = '';
        loader.style.display = 'block';

        try {
            const response = await axios.post('/process_resumes', formData, {
                headers: { 'Content-Type': 'multipart/form-data' },
            });

            console.log("DEBUG: API Response Data:", response.data);

            // Check for alert message from the response
            if (response.data.alert) {
                alert(response.data.alert);  // Display the alert message to the user
                loader.style.display = 'none';  // Hide the loader
                return;  // Stop further processing if an alert is shown
            }

            const results = response.data;
            if (results.length === 0) {
                resultsDiv.innerHTML = '<p>No results found.</p>';
                return;
            }

            let output = '<h2>Results</h2>';
            results.forEach(res => {
                console.log("DEBUG: Processing Result:", res);
                if (action === 'summarize') {
                    output += `<div class="result-card">
                        <h4>${res.filename}</h4>
                        <p><strong>Name:</strong> ${res.name || 'N/A'}</p>
                        <p><strong>Email:</strong> ${res.email || 'N/A'}</p>
                        <p><strong>Qualification:</strong> ${res.qualification || 'N/A'}</p>
                        <p><strong>Experience:</strong> ${res.experience || 'N/A'}</p>
                        <p><strong>Skills:</strong> ${res.skills || 'N/A'}</p>
                        <p><strong>Professional Evaluation:</strong> ${res.evaluation || 'N/A'}</p>
                    </div>`;
                } else if (action === 'match') {
                    output += `<div class="result-card">
                        <h4>${res.filename}</h4>
                        <p><strong>Percentage Match:</strong> ${res.percentage_match || 'N/A'}</p>
                        <p><strong>Justification:</strong> ${res.justification || 'N/A'}</p>
                    </div>`;
                }
            });
            resultsDiv.innerHTML = output;

        } catch (err) {
            console.error("DEBUG: API Error:", err);
            alert('Error processing resumes.');
        } finally {
            loader.style.display = 'none';
        }
    };

   
</script>
</body>
</html>
